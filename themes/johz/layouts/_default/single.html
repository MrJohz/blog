{{ define "head" }}
<meta name="description" content="{{ .Summary | plainify }}">
<link rel="canonical" href="{{ .Permalink }}">
{{ end }}

{{ define "main" }}
<article>
  {{ with .Resources.GetMatch "cover.jpg" }}
    {{ $size := (printf "%dx%d" (.Width) (mul (div .Width 16) 7)) }}
    {{ with .Crop $size }}
    <picture>
      <source
      srcset="
        {{(.Resize "300x webp").RelPermalink}} 300w,
        {{(.Resize "500x webp").RelPermalink}} 500w,
        {{(.Resize "720x webp").RelPermalink}} 720w,
        {{.RelPermalink}} {{.Width}}w,
      "
      sizes="(min-width: 900px) 720px, (min-width: 600px) calc(75vw + 60px), 100vw"
      width="{{ .Width }}"
      height="{{ .Height }}"
      type="image/webp" />
      <img class="cover" role="presentation" alt="" src="{{ .RelPermalink }}" width="{{ .Width }}" height="{{ .Height }}" />
    </picture>
    {{ end }}
  {{ end }}
  <header>
    <h1><a href="{{.RelPermalink}}">{{ .Title }}</a></h1>
  </header>
  {{if eq .Section "posts"}}
  <div class="details">
    <p>
      Posted <time datetime="{{.PublishDate | time.Format "2006-01-02"}}">{{ humanize .PublishDate.Day }} {{.PublishDate | time.Format "January 2006"}}</time> in
      {{range $k, $v := .GetTerms "tags"}}{{- if $k }}, {{end}}<a href="{{.RelPermalink}}">{{.Title}}</a>{{end}}
    </p>
    {{with .Param "cover"}}<p>Cover image based on 
      {{ $cover := . }}
      <em>{{ default "Unknown" (index $cover "name") }}</em>, 
      {{ default "Unknown Artist" (index $cover "artist") }}
      {{with index $cover "date"}}({{.}}){{end}}
      {{with index $cover "institution"}}
        {{with index $cover "institution-url"}}<a href="{{.}}">{{end}}
        {{.}}
        {{with index $cover "institution-url"}}</a>{{end}}
      {{end}}
    </p>{{end}}
  </div>
  {{end}}
  <div class="content">
    {{ if (.Fragments.Headings | len) }}
    {{/* I want to show a table of contents that is open by default on desktop,
         and closed by default on mobile.  Having two ToCs seems like the easiest
         option, somehow... */}}
    <details class="toc desktop" open>
      <summary>Contents</summary>
      {{ .TableOfContents }}
    </details>
    <details class="toc mobile">
      <summary>Contents</summary>
      {{ .TableOfContents }}
    </details>
    {{ end }}
    {{ .Content }}
  </div>
</article>
{{ end }}